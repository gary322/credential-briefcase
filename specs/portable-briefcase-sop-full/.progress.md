# Progress

## Current

- **Phase**: implement
- **Task**: Phase 12.2 Observability (OpenTelemetry end-to-end)
- **Status**: pending

## Original goal

Implement full sop.txt briefcase (extension, mobile signer, hardware keys, remote MCP routing, real x402/L402, revocation, AI policy compiler, enterprise control plane)

## Completed

- Research + constraints + gaps captured (`research.md`)
- Full requirements and acceptance criteria captured (`requirements.md`)
- Target architecture and contracts captured (`design.md`)
- End-to-end work breakdown captured (`tasks.md`)
- Phase 0: `justfile` + Node workspace + OpenAPI + generated TS types + CI updated
- Phase 1: spec-compliant MCP surface + streamable HTTP transport + remote MCP routing (registry + proxying) + e2e tests
- Phase 2.1: OAuth PRM discovery (RFC 9728) + daemon-managed OAuth sessions for remote MCP
- Phase 2.2: DPoP support for remote MCP OAuth flows (token binding + per-request proofs)
- Phase 2.3: extension-driven OAuth onboarding (native messaging host + MV3 extension; no daemon secrets in extension)
- Phase 3: WASM-first sandbox runtime + per-tool manifests + deny-by-default egress/filesystem enforcement + connector execution via sandbox host calls
- Phase 4.1: `crates/briefcase-keys` signer abstraction (software Ed25519 + P-256) integrated into daemon PoP signing
- Phase 4.2: PKCS#11 signer backend + SoftHSM integration tests (dockerized CI)
- Phase 4.3: TPM2 signer backend + swtpm integration tests (dockerized CI)
- Phase 4.4: Apple Keychain backend + macOS integration tests (Secure Enclave attempted; fallback supported)
- Phase 4.5: Windows CNG/NCrypt backend (software fallback tests in Windows CI)
- Phase 4.6: Capability PoP standardized on DPoP (JWT cnf.jkt binding + replay defense)
- Phase 5.1: Native messaging host (daemon API bridge; hardened framing; unix integration test)
- Phase 5.2: Extension UI for providers, approvals, receipts, budgets (+ Playwright e2e)
- Phase 5.3: Extension + UI hardening (CSP, minimal permissions, DNS rebinding defense)
- Phase 6.1: Mobile signer pairing + signer-authenticated approvals (Noise PSK + replay defense) + simulator test
- Phase 6.2: iOS signer app (Noise pairing + Secure Enclave P-256 signing) + CI build gate
- Phase 6.3: Android signer app (Noise pairing + Keystore-backed P-256 signing) + CI build gate
- Phase 6.4: Mobile signer policy integration (per-approval kind + Cedar integration + e2e tests)
- Phase 7: x402 v2 (PAYMENT-REQUIRED/PAYMENT-SIGNATURE) + external wallet helper + CI harness
- Phase 8: L402 Lightning (LND gRPC + CLN JSON-RPC) + regtest harness + CI
- Phase 9.1: OAuth revoke/forget flows (provider + remote MCP)
- Phase 9.2: VC status list verification (Bitstring Status List + cache + approval/deny knob)
- Phase 9.3: Capability revocation profile (jti denylist + refresh behavior)
- Phase 10.1: Define AI interface and “non-authoritative” invariants
- Phase 10.2: Policy compiler (proposal + diff + apply) + deterministic stub LLM
- Phase 10.3: Consent copilot summaries + anomaly detection dashboard (extension + UI)
- Phase 11.1: Enterprise control plane API (Postgres) + signed policy bundles + receipt ingestion + CI harness
- Phase 11.2: Daemon enrollment + periodic sync + signature verification + safe rollback (CLI + extension + tests)
- Phase 11.3: Optional remote custody signer (remote backend + control plane sign service + DPoP integration + tests)
- Phase 12.1: Fuzzing targets + scheduled CI fuzz job + "no secrets in logs" regression test

## Learnings

- This is a multi-platform effort; treat each major area as its own sub-spec/epic with its own CI gates.
- Keep enforcement centralized in `briefcased`; all new surfaces must remain non-secret-bearing.
- DPoP PoP changes the `Authorization` scheme (`DPoP` vs `Bearer`); mocks/tests must reflect that.

## Blockers

- None (planning phase complete). Implementation is large and should be sequenced by Phases 0-12 in `tasks.md`.

## Next steps

1. Phase 12.2: Observability (OpenTelemetry end-to-end).
2. Phase 12.3: Release automation for multi-artifact repo.
